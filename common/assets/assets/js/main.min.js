$(document).ready(function(){if($.pjax){$.pjax.defaults.timeout=20000}$.ytLoad();$(".fancybox").fancybox({beforeLoad:function(){var a=$(this).attr("href");if(a==window.location.pathname||a==window.location){return false}}})});function reloadPjax(a){if($.pjax){$.pjax.reload({container:"#"+a})}}function ajaxLoadHtml(b,a){var c=$("#"+b);showLoading(a,false);return $.post(c.attr("action"),c.serialize(),function(d){$("#"+a).html(d)}).always(function(){hideLoading(a,false)})}function showLoading(b,a){if(!a){b="#"+b}$(b).waitMe({effect:"bounce",text:"",color:"#000",sizeW:"",sizeH:""})}function hideLoading(b,a){if(!a){b="#"+b}$(b).waitMe("hide")}function deleteGridButton(a,d,b,c){if(!confirm(d)){return false}if(c!==""){$("#"+c).removeClass().html("")}$.post(a,null,function(e){if(!e.error){if(b!==""){reloadPjax(b)}if(c!==""){$("#"+c).addClass("alert alert-success").html(e.message)}}else{if(c!==""){$("#"+c).addClass("alert alert-danger").html(e.message)}}},"json");return false}function disableGridButton(a,b,c){if(c!==""){$("#"+c).removeClass().html("")}$.post(a,null,function(d){if(!d.error){if(b!==""){reloadPjax(b)}if(c!==""){$("#"+c).addClass("alert alert-success").html(d.message)}}else{if(c!==""){$("#"+c).addClass("alert alert-danger").html(d.message)}}},"json");return false}function loadAdvers(h,e,k,l){l.disableZoom=true;if(!e){loadAdversMaster(h,k,l);return false}var a="";var c=$("#search-country_id option:selected").text();var d=$("#search-province_id option:selected").text();var g=$("#search-city_id option:selected").text();var j=$("#search-address").val();var b=false;if(c!==""){a+=c+", "}if(d!==""){a+=d+", ";b=true}if(g!==""){a+=g+", ";b=true}if(!b){loadAdversMaster(h,k,l);return false}if(j!==""){a+=j}var f=new google.maps.Geocoder();if(f&&a!==""){f.geocode({address:a},function(n,m){if(m==google.maps.GeocoderStatus.OK){l.map.setCenter(n[0].geometry.location,14);l.map.fitBounds(n[0].geometry.viewport);loadAdversMaster(h,k,l)}else{loadAdversMaster(h,k,l)}})}else{loadAdversMaster(h,k,l)}}function loadAdversMaster(k,o,q){var p=q.map.getZoom();var c=q.map.getBounds();var g=c.getNorthEast();var n=c.getSouthWest();var f=g.lat();var m=n.lat();var e=n.lng();var j=g.lng();var b=q.map.getCenter();var l=b.lat();var a=b.lng();var h=$(o).serialize();h=h.replace(/[^&]+=\.?(?:&|$)/g,"");h+="&lat_max="+f+"&lat_min="+m+"&lng_min="+e+"&lng_max="+j;h+="&latitude="+l+"&longitude="+a+"&zoom="+p;if(k){var d="?"+h;window.history.replaceState({},null,d)}if(p>=17){getMarker(h,q);return false}$("#map_loading_img").show(300);if(q.markerAjaxObj){q.markerAjaxObj.abort()}deleteCurrentMarker(q);q.markerAjaxObj=$.get(q.clusterSearchUrl,h,function(u){var t=u.length;for(var s=0;s<t;s++){var v=getClusteringMarkerClass(u[s].adver_count);var r=new RichMarker({position:new google.maps.LatLng(u[s].lat,u[s].lng),map:q.map,content:'<div id="cluster'+s+'" class="bubble_container '+v[0]+'" onclick="mapZoomClusteringClick(adverObj, '+u[s].lat+", "+u[s].lng+", 2, "+u[s].adver_count+');"><strong>'+u[s].adver_count+"</strong></div>",draggable:false,shadow:false});q.markersArray.push(r)}q.disableZoom=false},"JSON").always(function(){$("#map_loading_img").hide(300);q.disableZoom=false})}function getClusteringMarkerClass(a){if(a<50){return["bubble1",53,52]}else{if(a<200){return["bubble2",56,55]}else{if(a<1000){return["bubble3",66,65]}else{if(a<10000){return["bubble4",78,77]}else{if(a>=10000){return["bubble5",90,89]}}}}}}function mapZoomClusteringClick(a,f,b,e,d){var c;if(d==1){c=17}else{c=a.map.getZoom()+e}a.map.setZoom(c);a.map.setCenter(new google.maps.LatLng(f,b))}function deleteCurrentMarker(a){if(a.markersArray){for(i=0;i<a.markersArray.length;i++){a.markersArray[i].setMap(null)}a.markersArray.length=0}}function getMarker(b,a){$("#map_loading_img").show(300);if(a.markerAjaxObj){a.markerAjaxObj.abort()}deleteCurrentMarker(a);a.markerAjaxObj=$.get(a.markerSearchUrl,b,function(f){var e=f.length;for(var d=0;d<e;d++){var c=new google.maps.Marker({position:new google.maps.LatLng(f[d].lat,f[d].lng),map:a.map,ids:f[d].ids,icon:a.markerImageUrl,title:f[d].title});google.maps.event.addListener(c,"click",function(g){var h=this;a.infoWindow.close();if(this.html){a.infoWindow.setContent(this.html);a.infoWindow.open(a.map,h)}else{$("#map_loading_img").show(300);if(a.infoWindowAjaxObj){a.infoWindowAjaxObj.abort()}a.infoWindowAjaxObj=$.get(a.infoWindowUrl,{ids:this.ids},function(j){h.html=generateHtmlContent(j);a.infoWindow.setContent(h.html);a.infoWindow.open(a.map,h)},"JSON").always(function(){$("#map_loading_img").hide(300)})}});a.markersArray.push(c)}},"JSON").always(function(){$("#map_loading_img").hide(300)})}function generateHtmlContent(h){var g='<div class="adver_infowindow">';for(var f=0;f<h.length;f++){if(f!==0){g+="<hr>"}g+='<p class="infowindow_gallery">';var d=h[f].gallery.length;var a;for(var c=0;c<d;c++){a=c+1;var b=(d!==1?"cursor: pointer;":"")+(a!==1?"display: none;":"");var e=(d!==1?"jQuery('#adversImage"+h[f].gallery[c].adver_id.toString()+a.toString()+"').hide();":"");e+=(d===a?"jQuery('#adversImage"+h[f].gallery[c].adver_id.toString()+"1').show();":"jQuery('#adversImage"+h[f].gallery[c].adver_id.toString()+(parseInt(a)+1).toString()+"').show();");g+='<img class="img-thumbnail img-responsive" id="adversImage'+h[f].gallery[c].adver_id.toString()+a.toString()+'" onclick="'+e+'" alt="'+h[f].gallery[c].title+'" style="'+b+'" src="'+h[f].gallery[c].url+'"/>';if(a===d){g+="<br/>"}}g+='</p><p class="infowindow_class">';g+='<a href="'+h[f].url+'" target="_blank">'+h[f].title+"</a><br/>";g+=h[f].category+"<br/>";g+=h[f].address+"<br/>";g+=h[f].full_address+"<br/>";g+="</p>"}g+="</div>";return g}function changeAdverView(a){if($("#hiddenViewMode").val()===a){return false}$("#hiddenViewMode").val(a);if(a==="map"){$("#gridView").hide();$("#mapView").show(200);setTimeout(function(){initializeAdverMap()},500)}else{if(a==="grid"){$("#mapView").hide();$("#gridView").show(200);reloadPjax("adverList-pjax")}}};